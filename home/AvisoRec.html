<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="AvisoRec.css">
    <title>Document</title>
</head>
<body>

    <a class="btnvoltar" href="Home.html"> Voltar </a>
    <div>
        <a class="btn" onclick="createAllServiceElements()">Pesquisar</a>
        <form class="search-container">
            <input type="text" id="search-bar" placeholder="Digite sua senha:">
            <a href="#"></a>
        </form>
        <a id="lblSaldo"> O saldo atual do cartão é de: </a>
    </div>

    <div>
        <form id="services">
        </form>
    </div>
    
<script>

    async function createAllServiceElements(){
        const numCartao = document.getElementById("search-bar").value;
        console.log(numCartao);

        const url = "http://localhost:3000/cartoes/" + numCartao;
        const response = await fetch(url);
        const cartao = await response.json();

        console.log(cartao);


        let get;
        get = await findAllComprasNaoUtilizadasByNumCartao(numCartao);

        console.log(get);
        
        var form = document.getElementById("services");

        for(i=0;i<get.length;i++){
            var divNova = document.createElement("div");    

            divNova.appendChild(document.createTextNode("Código da Compra:" + get[i].codCompra + "   "));
            divNova.appendChild(document.createTextNode("Código do serviço: " + get[i].codServico + "   "));
            divNova.appendChild(document.createTextNode("Nome do serviço: " + get[i].nome+ "   "));
            divNova.appendChild(document.createTextNode("Descrição do serviço: " + get[i].descricao+ "   "));
            divNova.appendChild(document.createTextNode("Código da recompensa: " + get[i].codRecompensa+ "   "));

            form.appendChild(divNova);
        }   
    }

    async function findAllComprasNaoUtilizadasByNumCartao(numCartao){
        const url = "http://localhost:3000/compras/utiliza" + numCartao;
        const response = await fetch(url);

        let compras = response.json();

        return compras;
    }
</script>
</body>
</html>